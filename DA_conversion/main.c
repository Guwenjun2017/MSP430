#include <msp430f169.h>
#include "type.h"
#include "delay.h"

long data, result, k;
uchar a, s, b;
uchar sin[256] = {
   128,131,134,137,140,143,146,149,153,156,159,162,165,168,171,174,177,180,182,185,188,191,194,196,199,201,204,207,209,211,214,216,218,220,223,225,227,229,231,232,234,236,238,239,241,242,243,245,246,247,248,249,250,251,252,253,253,254,254,255,255,255,255,255,255,255,255,255,255,254,254,253,253,252,251,251,250,249,248,247,245,244,243,241,240,238,237,235,233,232,230,228,226,224,222,219,217,215,213,210,208,205,203,200,198,195,192,189,187,184,181,178,175,172,169,166,163,160,157,154,151,148,145,142,139,135,132,129,126,123,120,116,113,110,107,104,101,98,95,92,89,86,83,80,77,74,71,68,66,63,60,57,55,52,50,47,45,42,40,38,36,33,31,29,27,25,23,22,20,18,17,15,14,12,11,10,8,7,6,5,4,4,3,2,2,1,1,0,0,0,0,0,0,0,0,0,0,1,1,2,2,3,4,5,6,7,8,9,10,12,13,14,16,17,19,21,23,24,26,28,30,32,35,37,39,41,44,46,48,51,54,56,59,61,64,67,70,73,75,78,81,84,87,90,93,96,99,102,106,109,112,115,118,121,124,127 
};
uchar cos[256] = {
                  256,255,255,255,255,255,254,254,253,252,252,251,250,249,248,247,246,244,243,242,240,239,237,235,234,232,230,228,226,224,222,220,218,215,213,211,208,206,203,201,198,196,193,190,187,185,182,179,176,173,170,167,164,161,158,155,152,149,146,142,139,136,133,130,127,124,120,117,114,111,108,105,102,99,96,92,89,86,83,81,78,75,72,69,66,64,61,58,55,53,50,48,45,43,41,38,36,34,32,30,28,26,24,22,20,19,17,15,14,13,11,10,9,8,7,6,5,4,3,2,2,1,1,0,0,0,0,0,0,0,0,0,0,1,1,2,2,3,4,5,6,7,8,9,10,11,13,14,15,17,19,20,22,24,26,28,30,32,34,36,38,41,43,45,48,50,53,55,58,61,63,66,69,72,75,78,81,83,86,89,92,96,99,102,105,108,111,114,117,120,124,127,130,133,136,139,142,146,149,152,155,158,161,164,167,170,173,176,179,182,185,187,190,193,196,198,201,203,206,208,211,213,215,218,220,222,224,226,228,230,232,234,235,237,239,240,242,243,244,246,247,248,249,250,251,252,252,253,254,254,255,255,255,255,255,256
};

void init_clk()
{
    uchar i;
    BCSCTL1 &= ~XT2OFF;       //打开XT振荡器
    BCSCTL2 |= SELM1 + SELS;
    do
    {
        IFG1 = ~OFIFG;        //清除振荡器错误标志
        for(i=0; i<100; i++)
            _NOP();
    }
    while((IFG1&OFIFG));      //如果标志为1，则继续循环等待
    IFG1 &= ~OFIFG;
}

void init_DAC12_0(void)
{
    ADC12CTL0 = REF2_5V + REFON;       //Internal 2.5V REF on
    DAC12_0CTL = DAC12IR + DAC12AMP_5 + DAC12ENC;  //启动DAC模块
    DAC12_0DAT = 0x0000;               //初始化电压
}

void fangbo()
{
    DAC12_0DAT = 0xffff;
    delay_ms(6);
    DAC12_0DAT = 0x0000;
    delay_ms(6);
}

void sanjiaobo()
{
    for(k=0; k<255; k++)
    {
	DAC12_0DAT = k;
    }
    for(k=255; k>0; k--)
    {
	DAC12_0DAT = k;
    }
}

void zhengxuanbo()
{
    DAC12_0DAT = sin[s++];
    delay_us(3);
}
void yuxuanbo()
{
    DAC12_1DAT = cos[b++];
    delay_us(3);
}
/**
 * main.c
 */
void main(void)
{
    WDTCTL = WDTPW | WDTHOLD;	// stop watchdog timer
    P6SEL = 0xff;
    P6DIR = 0xff;
    init_DAC12_0();
    s=0;
    while(1)
    {
        zhengxuanbo();
        yuxuanbo();
	//sanjiaobo();
	//fangbo();
    }
}
